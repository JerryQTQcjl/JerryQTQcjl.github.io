<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>GraalVM + SpringBoot 初探 | Jerry Chan</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="">
    <meta name="description" content="GraalVM 简介 GraalVM compiles your Java applications ahead of time into standalone binaries. These binaries are smaller, start up to 100x faster, provide peak performance with no warmup, and use less me">
<meta property="og:type" content="article">
<meta property="og:title" content="GraalVM + SpringBoot 初探">
<meta property="og:url" content="http://example.com/2024/09/03/GraalVM-SpringBoot-%E5%88%9D%E6%8E%A2/index.html">
<meta property="og:site_name" content="Jerry Chan">
<meta property="og:description" content="GraalVM 简介 GraalVM compiles your Java applications ahead of time into standalone binaries. These binaries are smaller, start up to 100x faster, provide peak performance with no warmup, and use less me">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s21.ax1x.com/2024/09/03/pAVwIZ6.png">
<meta property="og:image" content="https://s21.ax1x.com/2024/09/03/pAVwbJe.png">
<meta property="og:image" content="https://s21.ax1x.com/2024/09/03/pAVwXQA.png">
<meta property="og:image" content="https://s21.ax1x.com/2024/09/03/pAVwjsI.png">
<meta property="og:image" content="https://s21.ax1x.com/2024/09/03/pAVwvLt.png">
<meta property="og:image" content="https://s21.ax1x.com/2024/09/03/pAVwzeP.png">
<meta property="og:image" content="https://s21.ax1x.com/2024/09/03/pAV0po8.png">
<meta property="article:published_time" content="2024-09-03T02:27:04.000Z">
<meta property="article:modified_time" content="2024-09-03T02:42:00.591Z">
<meta property="article:author" content="Jerry Chan">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s21.ax1x.com/2024/09/03/pAVwIZ6.png">
    
        <link rel="alternate" type="application/atom+xml" title="Jerry Chan" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Jerry Chan</h5>
          <a href="mailto:jerrtqtqcjl@gmail.com" title="jerrtqtqcjl@gmail.com" class="mail">jerrtqtqcjl@gmail.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                目录
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/JerryQTQcjl" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">GraalVM + SpringBoot 初探</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">GraalVM + SpringBoot 初探</h1>
        <h5 class="subtitle">
            
                <time datetime="2024-09-03T02:27:04.000Z" itemprop="datePublished" class="page-time">
  2024-09-03
</time>


            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#GraalVM-简介"><span class="post-toc-number">1.</span> <span class="post-toc-text">GraalVM 简介</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#安装-GraalVM"><span class="post-toc-number">2.</span> <span class="post-toc-text">安装 GraalVM</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Java-Demo"><span class="post-toc-number">3.</span> <span class="post-toc-text">Java Demo</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#SpringBoot-Demo"><span class="post-toc-number">4.</span> <span class="post-toc-text">SpringBoot Demo</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#总结"><span class="post-toc-number">5.</span> <span class="post-toc-text">总结</span></a></li></ol>
        </nav>
    </aside>


<article id="post-GraalVM-SpringBoot-初探"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">GraalVM + SpringBoot 初探</h1>
        <div class="post-meta">
            <time class="post-time" title="2024-09-03 10:27:04" datetime="2024-09-03T02:27:04.000Z"  itemprop="datePublished">2024-09-03</time>

            


            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h3 id="GraalVM-简介"><a href="#GraalVM-简介" class="headerlink" title="GraalVM 简介"></a>GraalVM 简介</h3><blockquote>
<p>GraalVM compiles your Java applications ahead of time into standalone binaries. These binaries are smaller, start up to 100x faster, provide peak performance with no warmup, and use less memory and CPU than applications running on a Java Virtual Machine (JVM).</p>
<p>GraalVM reduces the attack surface of your application. It excludes unused classes, methods, and fields from the application binary. It restricts reflection and other dynamic Java language features to build time only. It does not load any unknown code at run time.</p>
<p>Popular microservices frameworks such as Spring Boot, Micronaut, Helidon, and Quarkus, and cloud platforms such as Oracle Cloud Infrastructure, Amazon Web Services, Google Cloud Platform, and Microsoft Azure all support GraalVM.</p>
<p>With profile-guided optimization and the G1 (Garbage-First) garbage collector, you can get lower latency and on-par or better peak performance and throughput compared to applications running on a Java Virtual Machine (JVM).</p>
<p>You can use the GraalVM JDK just like any other Java Development Kit in your IDE.</p>
</blockquote>
<p>以上是来自<a href="https://www.graalvm.org/latest/docs/introduction/" target="_blank" rel="noopener">官网</a>上的介绍，简单来说主要包括几点：</p>
<ol>
<li>GraalVM 支持 AOT（Ahead-Of-Time），提前将 Java 应用编译成可执行的二进制文件，相较于编译成字节码由 JVM 即使编译，拥有更快的速度以及更小的内存。</li>
<li>GraalVM 限制了 Java 的一些动态能力，例如反射、动态代理、java agent等，只允许在构建 Native Image 时使用。（AOT 模式）</li>
<li>优化 JVM 即时编译（JIT），使用 GraalVM 编译器替换 C2 编译器，提升运行时性能。</li>
</ol>
<h3 id="安装-GraalVM"><a href="#安装-GraalVM" class="headerlink" title="安装 GraalVM"></a>安装 GraalVM</h3><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://s21.ax1x.com/2024/09/03/pAVwIZ6.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p><a href="https://www.graalvm.org/downloads/#" target="_blank" rel="noopener">官网</a>提供了多种下载方式，目前官网只能下载 Java17-22 的版本，如果想要下载其他版本可以到 <a href="https://github.com/graalvm/graalvm-ce-builds/releases?page=2" target="_blank" rel="noopener">github</a> 下载。</p>
<p>由于本人使用的是 macos，所以就简单介绍下 macos 下的安装方式，流程还是很简单的，其他操作系统可以进行参考官方文档。</p>
<ol>
<li>下载对应的 graalvm 版本</li>
<li>解压之后移动到 /Library/Java/JavaVirtualMachines 目录下<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -xzf graalvm-jdk-&lt;version&gt;_macos-&lt;architecture&gt;.tar.gz</span><br><span class="line">sudo mv graalvm-jdk-&lt;version&gt;_macos-&lt;architecture&gt; /Library/Java/JavaVirtualMachines</span><br></pre></td></tr></table></figure></li>
<li>添加环境变量</li>
<li>如果是从 github 下载的低版本还需要进行一下两个步骤:<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  If you are using macOS Catalina and later you may need to remove the quarantine attribute from the bits before you can use them.</span></span><br><span class="line">sudo xattr -r -d com.apple.quarantine path/to/graalvm/folder/</span><br><span class="line"><span class="comment"># 官网下载的是默认自带的</span></span><br><span class="line">gu install native-image</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="Java-Demo"><a href="#Java-Demo" class="headerlink" title="Java Demo"></a>Java Demo</h3><p>以下是官网提供的和一个纯 Java 应用 Demo:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ylb.explore.graalvm.java;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Hello, Native World!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将 Java 代码编译成字节码</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javac HelloWorld.java</span><br></pre></td></tr></table></figure>

<p>将字节码编译成可执行二进制文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$JAVA_HOME</span>/bin/native-image com.ylb.explore.graalvm.java.HelloWorld HelloWorld</span><br></pre></td></tr></table></figure>

<p>执行效果</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ./HelloWorld                                                                  </span><br><span class="line">Hello, Native World!</span><br></pre></td></tr></table></figure>

<p>总体还是非常简单的，编译时注意一下类路径即可。</p>
<h3 id="SpringBoot-Demo"><a href="#SpringBoot-Demo" class="headerlink" title="SpringBoot Demo"></a>SpringBoot Demo</h3><p>接下来看一下一个简单的 SpringBoot</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> startTime = System.currentTimeMillis();</span><br><span class="line">        SpringApplication.run(DemoApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">        <span class="keyword">long</span> endTime = System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">"cost: "</span> + (endTime - startTime));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IndexController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">showHelloWorld</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">                hello world</span></span><br><span class="line"><span class="string">                template</span></span><br><span class="line"><span class="string">                "</span><span class="string">""</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上代码提供一个简单的 http 接口，接下来配置下 maven 相关插件，如果是使用 gradle 的话可以参考<a href="https://graalvm.github.io/native-build-tools/latest/gradle-plugin.html" target="_blank" rel="noopener">官方文档</a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>windfall-explore-graalvm-spring-boot<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>21<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>21<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>21<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.main-class</span>&gt;</span>com.ylb.explore.graalvm.spring.boot.DemoApplication<span class="tag">&lt;/<span class="name">project.main-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-autoconfigure<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.graalvm.buildtools<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>native-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- imageName用于设置生成的二进制文件名称 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">imageName</span>&gt;</span>$&#123;project.artifactId&#125;<span class="tag">&lt;/<span class="name">imageName</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>$&#123;project.main-class&#125;<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">source</span>&gt;</span>21<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">target</span>&gt;</span>21<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">compilerArgs</span>&gt;</span>--enable-preview<span class="tag">&lt;/<span class="name">compilerArgs</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>直接下执行 maven 插件将代码编译成二进制文件:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn native:compile</span><br></pre></td></tr></table></figure>

<p>这个时候遇到了编译时的第一个坑</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://s21.ax1x.com/2024/09/03/pAVwbJe.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<p>这里真正的提示错误没有高亮，反而是下面的 native-image -cp 语句进行了高亮，异步流程就会错过，这里耽搁了我不少时间🌚，解决方案也很简单，在插件中添加配置参数即可</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>$&#123;project.main-class&#125;<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>添加上 mainClass 后，重新执行编译命令，一切都十分顺利</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://s21.ax1x.com/2024/09/03/pAVwXQA.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<p>经过漫长的等待，终于编译成功，那么不出意外，意外马上就来了</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ windfall-explore-graalvm-spring-boot</span><br><span class="line"></span><br><span class="line">  .   ____          _            __ _ _</span><br><span class="line"> /\\ / ___<span class="string">'_ __ _ _(_)_ __  __ _ \ \ \ \</span></span><br><span class="line"><span class="string">( ( )\___ | '</span>_ | <span class="string">'_| | '</span>_ \/ _` | \ \ \ \</span><br><span class="line"> \\/  ___)| |_)| | | | | || (_| |  ) ) ) )</span><br><span class="line">  <span class="string">'  |____| .__|_| |_|_| |_\__, | / / / /</span></span><br><span class="line"><span class="string"> =========|_|==============|___/=/_/_/_/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> :: Spring Boot ::                (v3.3.3)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Application run failed</span></span><br><span class="line"><span class="string">org.springframework.boot.AotInitializerNotFoundException: Startup with AOT mode enabled failed: AOT initializer com.ylb.explore.graalvm.spring.boot.DemoApplication__ApplicationContextInitializer could not be found</span></span><br><span class="line"><span class="string">        at org.springframework.boot.SpringApplication.addAotGeneratedInitializerIfNecessary(SpringApplication.java:443)</span></span><br><span class="line"><span class="string">        at org.springframework.boot.SpringApplication.prepareContext(SpringApplication.java:400)</span></span><br><span class="line"><span class="string">        at org.springframework.boot.SpringApplication.run(SpringApplication.java:334)</span></span><br><span class="line"><span class="string">        at org.springframework.boot.SpringApplication.run(SpringApplication.java:1363)</span></span><br><span class="line"><span class="string">        at org.springframework.boot.SpringApplication.run(SpringApplication.java:1352)</span></span><br><span class="line"><span class="string">        at com.ylb.explore.graalvm.spring.boot.DemoApplication.main(DemoApplication.java:11)</span></span><br><span class="line"><span class="string">        at java.base@21.0.4/java.lang.invoke.LambdaForm$DMH/sa346b79c.invokeStaticInit(LambdaForm$DMH)</span></span><br></pre></td></tr></table></figure>

<p>出现这个错误的主要原因是缺少了 spring boot 的 AOT 元文件信息，需要先通过以下命令编译生成 AOT 元文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mvn clean compil</span><br><span class="line">mvn spring-boot:process-aot</span><br><span class="line">mvn spring-boot:process-aot</span><br></pre></td></tr></table></figure>

<p>接下来再执行  mvn native:compile，坐等二进制文件编译完成即可。</p>
<p>下面对比下使用 jvm 启动和使用二进制文件的耗时:</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://s21.ax1x.com/2024/09/03/pAVwjsI.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://s21.ax1x.com/2024/09/03/pAVwvLt.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<p>虽然没有到达了官网所说的 100 倍那么多，但也这个差距相当恐怖了。</p>
<p>以上是在本地编译成可执行文件的方式，spring 官方还提供了直接编译构建 docker 镜像的方式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn spring-boot:build-image -Pnative</span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://s21.ax1x.com/2024/09/03/pAVwzeP.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://s21.ax1x.com/2024/09/03/pAV0po8.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<p>内部是基于 paketobuildpacks/builder-jammy-tiny 和 paketobuildpacks/run-jammy-tiny 构建镜像，底层原理还未了解，但大概率也是作为基础镜像安装相关环境后，编译代码，然后瘦身镜像。这里有一个，请确保 docker 配置了足够多的内存，别问我怎么知道🌚</p>
<p>这里还有一个比较坑的点，使用 GraalVM 编译好的二进制文件，无法直接使用 JDK 提供的一下工具，例如 jstack、jstat 等等，可能对之前习惯使用这些工具的童鞋来说，是难以接受的。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ jps</span><br><span class="line">43203 Main</span><br><span class="line">18475 Launcher</span><br><span class="line">18847 Jps</span><br><span class="line"></span><br><span class="line">$ ps -ef | grep windfall</span><br><span class="line">501 18834 27099   0 10:21AM ttys003    0:00.09 /windfall-common/windfall-explore/windfall-explore-graalvm/windfall-explore-graalvm-spring-boot/target/windfall-explore-graalvm-spring-boot</span><br><span class="line"></span><br><span class="line"><span class="comment"># 甚至会导致进程直接中断，真恐怖</span></span><br><span class="line">$ jstack 19194                                                                                                                                                                  </span><br><span class="line">19194: No such process</span><br></pre></td></tr></table></figure>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li>GraalVM 提供了 AOT 编译器，大大提升了代码启动效率，但同时也大大增加了编译时间。</li>
<li>GraalVM 限制了 Java 运行时动态加载的特性，可能很多深度使用 Java 动态加载的应用或者工具并不适用。</li>
<li>GraalVM AOT 编译出来的二进制文件无法使用 JDK 提供的一些监控诊断工具。</li>
</ul>
<blockquote>
<p>参考：</p>
<p><a href="https://www.graalvm.org/latest/reference-manual/native-image/" target="_blank" rel="noopener">https://www.graalvm.org/latest/reference-manual/native-image/</a></p>
<p><a href="https://graalvm.github.io/native-build-tools/latest/maven-plugin.html" target="_blank" rel="noopener">https://graalvm.github.io/native-build-tools/latest/maven-plugin.html</a></p>
<p><a href="https://docs.spring.io/spring-boot/how-to/native-image/developing-your-first-application.html" target="_blank" rel="noopener">https://docs.spring.io/spring-boot/how-to/native-image/developing-your-first-application.html</a></p>
</blockquote>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2024-09-03T02:42:00.591Z" itemprop="dateUpdated">2024-09-03 10:42:00</time>
</span><br>


        
    </div>
    
    <footer>
        <a href="http://example.com">
            <img src="/img/avatar.jpg" alt="Jerry Chan">
            Jerry Chan
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            

            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://example.com/2024/09/03/GraalVM-SpringBoot-%E5%88%9D%E6%8E%A2/&title=《GraalVM + SpringBoot 初探》 — Jerry Chan&pic=http://example.com/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://example.com/2024/09/03/GraalVM-SpringBoot-%E5%88%9D%E6%8E%A2/&title=《GraalVM + SpringBoot 初探》 — Jerry Chan&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://example.com/2024/09/03/GraalVM-SpringBoot-%E5%88%9D%E6%8E%A2/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《GraalVM + SpringBoot 初探》 — Jerry Chan&url=http://example.com/2024/09/03/GraalVM-SpringBoot-%E5%88%9D%E6%8E%A2/&via=http://example.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://example.com/2024/09/03/GraalVM-SpringBoot-%E5%88%9D%E6%8E%A2/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2024/09/07/%E8%AE%A9%E6%9C%AC%E5%9C%B0%E9%85%8D%E7%BD%AE%E4%BC%98%E5%85%88%E4%BA%8E-apollo-%E9%85%8D%E7%BD%AE/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">让本地配置优先于 apollo 配置</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2024/08/30/nacos-spring-%E7%83%AD%E6%9B%B4%E6%96%B0/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">nacos spring 热更新</h4>
      </a>
    </div>
  
</nav>



    




















</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Jerry Chan &copy; 2023 - 2024</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://example.com/2024/09/03/GraalVM-SpringBoot-%E5%88%9D%E6%8E%A2/&title=《GraalVM + SpringBoot 初探》 — Jerry Chan&pic=http://example.com/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://example.com/2024/09/03/GraalVM-SpringBoot-%E5%88%9D%E6%8E%A2/&title=《GraalVM + SpringBoot 初探》 — Jerry Chan&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://example.com/2024/09/03/GraalVM-SpringBoot-%E5%88%9D%E6%8E%A2/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《GraalVM + SpringBoot 初探》 — Jerry Chan&url=http://example.com/2024/09/03/GraalVM-SpringBoot-%E5%88%9D%E6%8E%A2/&via=http://example.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://example.com/2024/09/03/GraalVM-SpringBoot-%E5%88%9D%E6%8E%A2/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACt0lEQVR42u3aQXLbQAwEQP3/005VTq7YVmaAXVmH5skli+Q2DwSE2ccjPj7+Hp///nw8//zrFZ5f//l9HzcOPDw8vNHSfzq+fme2xORx7P/7zRrw8PDwrvHal3Jy+01heP5wkzXj4eHhvQMvefU//35bcvLHh4eHh/f+vHwYMWyF8fDw8N6el7fIm9Ft276/dNaCh4eH172B6wDsd/++nu/h4eHhjVL1fTCWB1qzIO0/K8TDw8O7wNu3yKde6+2wowjG8PDw8I7y8pHrpo9NIrFN5BZNWfDw8PAO8dob50HU7GG1EVqiwMPDwzvLy8P42cg1b9DboCu6Ah4eHt4FXj4aOLUdqv1mXh6KHwB4eHh4C17Sns62QyXD31l5KM7Fw8PDu8A72yK3W6Nm2w7yKA4PDw/vHm8W+W8mx/nS28DskdcfPDw8vAu8tmDkhaFtwWdjETw8PLzX89rp7+Zx5IBZ+46Hh4f3St7sljmp3ZQw3DSAh4eHd5SXB2D7B3EDVgRgeHh4eId4s9Z2P5zNx74HRrp4eHh4l3n5RoE8vM/HtfnooVgnHh4e3iHeLOiabSrNG/FZ4fnmynh4eHgXeKeSo3bcsKljbTnBw8PDu8HbXPRsXt+eFf0AwMPDwzvKawP+vJnOP5mNZYtfDHh4eHhHefmLPunKZ+ODdoybb+HCw8PDu8Gbvaw3I4l8ue0I+MeWGg8PD+8ory0Mm9hs1ijnI48DdQ8PDw8v4H2URx5EzfK3vEhEjwwPDw/vAm+2gSDP5Yft76GigoeHh3ePN4u4ct4s/m+HF8Pqh4eHh7fgtQOIdnGzTGpWuvDw8PDekzdbYl6Ent+3GHng4eHh/Sovx+y3ICRFJToXDw8P7xqvHSu0bXQ+UMgjt+hcPDw8vAu8TQCWN755qWg3Wl3M9/Dw8PD+/eQPoEwr8EBjFYMAAAAASUVORK5CYII=" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '大爷别走呀！';
            clearTimeout(titleTime);
        } else {
            document.title = '来啦，老弟!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
